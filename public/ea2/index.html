<!doctype html>
<html lang="de">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>EA2 | 2D Geometrie aus Linien | Pascal H√ºrten</title>
    <link rel="stylesheet" href="../style.css">
    <link rel="stylesheet" href="../ea2/style.css">
</head>

<body>
    <main>
        <nav class="breadcrumb" aria-label="Breadcrumb">
            <a href="../index.html">‚Üê Zur√ºck zur √úbersicht</a>
        </nav>

        <h1>EA2 - 2D Geometrie aus Linien - Pascal H√ºrten</h1>

        <section id="viewer" aria-labelledby="viewer-heading">
            <h2 id="viewer-heading">WebGL Drawing Canvas</h2>


            <div id="canvas-wrap">
                <canvas id="background-canvas" class="background" width="720" height="480"></canvas>
                <canvas id="background-image-canvas" class="background-image" width="720" height="480"
                    aria-hidden="true"></canvas>
                <canvas id="overlay-canvas" class="overlay" width="720" height="480" aria-hidden="true"></canvas>
                <aside id="controls">
                    <div class="row">
                        <label for="mode">Draw-Mode:</label>
                        <select id="mode">
                            <option value="LINES">LINES</option>
                            <option value="LINE_STRIP" selected>LINE_STRIP</option>
                            <option value="LINE_LOOP">LINE_LOOP</option>
                            <option value="TRIANGLES">TRIANGLES</option>
                            <option value="TRIANGLE_STRIP">TRIANGLE_STRIP</option>
                            <option value="TRIANGLE_FAN">TRIANGLE_FAN</option>
                        </select>
                        <label for="lineWidth">Line width:</label>
                        <input id="lineWidth" type="range" min="1" max="10" value="1">
                        <span id="lineWidthVal">1</span>
                        <button id="undo">Undo</button>
                        <button id="clear">Clear</button>
                    </div>
                    <div class="row">
                        <strong>Layers:</strong>
                    </div>
                    <div id="layers-container" class="layers-list">
                        <!-- layers will be added here dynamically -->
                    </div>
                    <div class="row">
                        <button id="addLayer">+ Add Layer</button>
                        <small id="vertexCount" class="justify-self-end">Vertices: 0</small>
                    </div>
                    <hr>
                    <div class="row">
                        <label for="showOverlay">Show Vertices:</label>
                        <input id="showOverlay" type="checkbox">
                    </div>
                    <div class="row">
                        <label for="snapToGrid">Snap to Grid:</label>
                        <input id="snapToGrid" type="checkbox">
                        <label for="gridSize">Grid Size:</label>
                        <input id="gridSize" type="range" min="5" max="100" value="10">
                        <span id="gridSizeVal">20</span>
                    </div>
                    <div class="row">
                        <label for="colorMode">Color Mode:</label>
                        <input id="colorMode" type="checkbox">
                        <label for="vertexColor">Vertex Color:</label>
                        <input id="vertexColor" type="color" value="#ff0000">
                        <label for="colorRadius">Brush Size:</label>
                        <input id="colorRadius" type="range" min="5" max="50" value="20">
                        <span id="colorRadiusVal">20px</span>
                    </div>
                    <div class="row">
                        <strong>Animation:</strong>
                        <button id="playPauseBtn">‚ñ∂Ô∏è Play</button>
                        <button id="resetTimeBtn">üîÑ Reset</button>
                    </div>
                    <div class="row" style="flex: 1">
                        <label for="periodInput">Period (s):</label>
                        <input id="periodInput" type="number" min="1" max="300" value="60" step="1">
                        <label for="timeSlider">Time:</label>
                        <input id="timeSlider" type="range" min="0" max="100" value="0">
                        <span id="timeVal">0.00s</span>
                    </div>
                    <hr>
                    <div class="row">
                        <label for=" bgImage">Background Image:</label>
                        <input id="bgImage" type="file" accept="image/*" style="display:inline-block">
                        <input id="bgOpacity" type="range" min="0" max="100" value="50" title="Background opacity">
                        <span id="bgOpacityVal">50%</span>
                        <button id="clearBgImage">Clear BG</button>
                    </div>
                    <div class="row buttons" style="justify-content: space-between;">
                        <div class="row buttons">
                            <label for="fileInput">Import vertices:</label>
                            <input id="fileInput" type="file" accept=".obj,.json" style="display:inline-block">
                        </div>
                        <button id="loadDefault">Load default</button>
                        <button id="export">Export vertices</button>
                    </div>
                </aside>
            </div>

            <!-- Shader Editor Drawer (Bottom Panel) -->
            <div id="shaderDrawer" class="shader-drawer">
                <div class="shader-drawer-header">
                    <h2>Shader Editor - <span id="shaderLayerName">Layer</span></h2>
                    <button id="shaderDrawerClose" class="shader-drawer-close">&times;</button>
                </div>
                <div class="shader-drawer-content">
                    <div class="shader-editor-column">
                        <h3>Vertex Shader</h3>
                        <textarea id="vertexShaderText" class="shader-textarea" spellcheck="false"></textarea>
                    </div>
                    <div class="shader-editor-column">
                        <h3>Fragment Shader</h3>
                        <textarea id="fragmentShaderText" class="shader-textarea" spellcheck="false"></textarea>
                    </div>
                    <div class="shader-error" id="shaderError"></div>
                </div>
                <div class="shader-drawer-footer">
                    <button id="shaderApply" class="btn-primary">Apply Shaders</button>
                    <button id="shaderReset" class="btn-secondary">Reset to Default</button>
                    <button id="shaderCancel" class="btn-secondary">Close</button>
                </div>
            </div>
        </section>

        <section id="doc">
            <h2>Quellen & Hinweise</h2>

            <h3>Anleitung zur Nutzung:</h3>
            <ol>
                <li><strong>Zeichnen:</strong> Klicke auf das Canvas, um Punkte hinzuzuf√ºgen</li>
                <li><strong>Kontinuierliches Zeichnen:</strong> Halte Strg/Ctrl und ziehe, um mehrere Punkte zu
                    setzen</li>
                <li><strong>R√ºckg√§ngig:</strong> Rechtsklick entfernt den letzten Punkt</li>
                <li><strong>Layer verwalten:</strong> Erstelle neue Layer mit "+ Add Layer" und wechsle zwischen
                    ihnen</li>
                <li><strong>Draw-Mode:</strong> W√§hle verschiedene Rendering-Modi (LINE_STRIP, TRIANGLES, etc.)</li>
                <li><strong>Color Mode:</strong> Aktiviere den Color Mode, w√§hle eine Farbe und klicke auf Vertices um
                    sie einzuf√§rben</li>
                <li><strong>Animation:</strong> Steuere die Zeit-Animation mit Play/Pause, Time-Slider und
                    Period-Einstellung</li>
                <li><strong>Grid-Snap:</strong> Aktiviere Raster-Einrasten f√ºr pr√§zises Zeichnen</li>
                <li><strong>Vertex Snap:</strong> Halte die <strong>S</strong>-Taste, w√§hrend du einen Punkt setzt, um
                    ihn an den n√§chsten existierenden Vertex zu binden (√ºber alle Layer hinweg)</li>
                <li><strong>Shader bearbeiten:</strong> Klicke auf "‚úé Shader" bei einem Layer f√ºr erweiterte Effekte
                </li>
                <li><strong>Export/Import:</strong> Speichere deine Arbeit oder lade Vorlagen</li>
            </ol>

            <h3>Technische Umsetzung: Das Zeichentool</h3>
            <p><strong>√úberblick:</strong> Das Zeichentool basiert auf einer modularen Architektur mit drei Kernmodulen
                f√ºr Rendering, Dienstprogramme und Benutzeroberfl√§che.</p>

            <p>Module:</p>
            <ul style="margin: 8px 0; font-size: 13px;">
                <li><code>vertex-core.js</code> ‚Äì WebGL2-Rendering, Layer-Verwaltung, Shader-Kompilierung</li>
                <li><code>vertex-utils.js</code> ‚Äì Hilfsfunktionen (NDC-Konvertierung, Distanzberechnung,
                    Vertex-Snapping)</li>
                <li><code>vertex-editor.js</code> ‚Äì Interaktive UI (Zeichnen, F√§rben, Layer-Management, Animation)</li>
            </ul>

            <p><strong>Koordinatensystem:</strong> Das Tool verwendet normalisierte Ger√§tekoordinaten (NDC), bei denen
                der Canvas von -1 bis +1 in beide Richtungen (x, y) reicht. Dies erm√∂glicht unabh√§ngig von der
                Canvas-Gr√∂√üe konsistente Geometrie.</p>

            <p><strong>Layer-System:</strong> Jeder Layer speichert:</p>
            <ul style="margin: 8px 0; font-size: 13px;">
                <li>Vertices: Array von [x, y] Positionen</li>
                <li>Colors: Optional per-Vertex RGB-Werte (0...1)</li>
                <li>Vertex/Fragment Shaders: Programmierbare Effekte</li>
                <li>Draw-Mode: GL-Primitive (LINES, LINE_STRIP, TRIANGLES, etc.)</li>
                <li>Layer-Name &amp; ID: F√ºr Management und Export</li>
            </ul>

            <p><strong>Vertex-Snapping:</strong> Beim Zeichnen mit gedr√ºckter <strong>S</strong>-Taste werden neue
                Vertices automatisch an existierende Vertices (Snap-Radius 0.15 NDC) aus allen Layern gebunden. Dies
                vereinfacht pr√§zises Zeichnen und Verbinden von Geometrien √ºber Layer-Grenzen hinweg.</p>

            <p><strong>Per-Vertex Coloring:</strong> Der Color Mode erm√∂glicht pixelgenaue F√§rbung. Farben werden pro
                Vertex im RGB-Format (0...1) gespeichert und durch Aktivieren des Color Mode mit einem konfigurierbaren
                Pinsel (Brush Size 5...50px) angewendet. Im Fragment Shader werden Farben automatisch interpoliert
                (Gouraud Shading).</p>

            <p><strong>Shader-Programmierung: Verf√ºgbare Attribute & Uniforms</strong></p>
            <p>Beim Bearbeiten von Shadern stehen folgende Variablen zur Verf√ºgung:</p>
            <p><strong>Vertex Attribute (Input):</strong></p>
            <ul style="margin: 8px 0; font-size: 13px;">
                <li><code>in vec2 aPos</code> ‚Äì Vertex-Position in NDC-Koordinaten (-1...1)</li>
                <li><code>in vec3 aColor</code> ‚Äì RGB-Farbe des Vertices (0...1 pro Kanal)</li>
            </ul>
            <p><strong>Uniforms (f√ºr alle Vertices gleich):</strong></p>
            <ul style="margin: 8px 0; font-size: 13px;">
                <li><code>uniform vec4 uColor</code> ‚Äì Layer-Farbe (RGBA)</li>
                <li><code>uniform float uTime</code> ‚Äì urspr√ºngliche Zeit in Sekunden (0...period)</li>
                <li><code>uniform float uNormalizedTime</code> ‚Äì normalisierte Zeit (0...1, springt nie)</li>
                <li><code>uniform float uPhase</code> ‚Äì als Bogenma√ü (0...2œÄ) f√ºr sin/cos-Funktionen</li>
                <li><code>uniform float uPeriod</code> ‚Äì Animationsperiode in Sekunden</li>
                <li><code>uniform vec2 uResolution</code> ‚Äì Canvas-Aufl√∂sung in Pixeln</li>
            </ul>
            <p><strong>Fragment Shader Input:</strong></p>
            <ul style="margin: 8px 0; font-size: 13px;">
                <li><code>in vec3 vColor</code> ‚Äì interpolierte Vertex-Farbe vom Vertex-Shader</li>
            </ul>

            <p><strong>Export &amp; Persistierung:</strong> Geometrie wird als JSON mit vollst√§ndiger Layer-Information
                exportiert. Dies erm√∂glicht iteratives Arbeiten und Weitergabe von Werken. Default-Geometrie
                (<code>defaultVertices.json</code>) wird beim Laden automatisch eingelesen.</p>

            <h3>Referenzen:</h3>
            <ul>
                <li>Standardm√§√üig l√§dt dieses Tool beim Start folgende JSON-Datei: <a href="./defaultVertices.json"
                        target="_blank">defaultVertices.json</a></li>
                <li>Wal wurde von diesem Foto abgepaust: <a href="https://jooinn.com/img/get"
                        target="_blank">https://jooinn.com/img/get</a></li>
                <li>Repo: <a href="https://git.mylab.th-luebeck.de/pascal.huerten/gvt/-/tree/master/public/ea2"
                        target="_blank">https://git.mylab.th-luebeck.de/pascal.huerten/gvt/-/tree/master/public/ea2</a>
                </li>
            </ul>
            <!-- Screenshots of process in a row -->
            <div class="doc-image-gallery">
                <figure>
                    <img src="wal-ref-1.png" alt="Referenzphoto eines Wals" height="200">
                    <figcaption>1. Referenz und Kontur: Walphoto als Hintergrund um Kontur abzupausen</figcaption>
                </figure>
                <figure>
                    <img src="wal-ref-2.png" alt="Gezeichnete Walkontur mit Linien" height="200">
                    <figcaption>2. Schattierung: Linienmuster und Kreuzschraffur um Volumen anzudeuten und die Textur
                        der zerkl√ºfteten Haut des Buckelwals nachzubilden</figcaption>
                </figure>
            </div>
        </section>
    </main>
    <script src="vertex-core.js" defer></script>
    <script src="vertex-utils.js" defer></script>
    <script src="vertex-editor.js" defer></script>
    <script src="script.js" defer></script>
</body>

</html>

</body>

</html>